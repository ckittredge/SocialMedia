!function(){var a=angular.module("underscore",[]);a.factory("_",["$window",function(a){return a._}])}(),function(){angular.module("NewsFeed",["underscore"])}(),function(){angular.module("SideMenu",["underscore"])}(),function(){angular.module("Widgets",["underscore","NewsFeed"])}(),function(){angular.module("AppUsers",[])}(),function(){var a=angular.module("SocialMediaApp",["ui.router","underscore","NewsFeed","SideMenu","Widgets","AppUsers"]);a.config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("NewsFeed",{url:"/",views:{SideMenu:{templateUrl:"app/sideMenu/partials/sideMenu.tpl.html",controller:"SideMenuController"},MainView:{templateUrl:"app/newsFeed/partials/newsFeed.tpl.html",controller:"NewsFeedController"}}}).state("FriendsList",{url:"/Friends",views:{SideMenu:{templateUrl:"app/sideMenu/partials/sideMenu.tpl.html",controller:"SideMenuController"},MainView:{templateUrl:"app/users/partials/friendsList.tpl.html",controller:"FriendsListController"}}})}]),a.controller("MainController",["$scope","$window","$state","appUserDataService",function(a,b,c,d){function e(){c.go("NewsFeed")}a.main={},d.getCurrentUser().then(function(c){if(!c.success||null==c||null==c.data||null==c.data.data)throw"Current user is null";a.main.currentUser=b.currentUser=c.data.data,a.$broadcast("currentUserSet",c.data.data)}),e()}])}(),function(){angular.module("NewsFeed").controller("NewsFeedController",["$scope","newsFeedDataService","NEWS_FEED_TYPES",function(a,b,c){function d(){a.newsFeed.getNewsFeedItems()}a.newsFeed={items:[]},a.newsFeed.getNewsFeedItems=function(){b.getNewsFeedItems().then(function(b){if(!b.success||null==b||null==b.data)throw"Returned null items";_.each(b.data.data,function(b){var c=_.findWhere(a.newsFeed.items,{_id:b._id});null==c&&a.newsFeed.items.push(b)})})},d(),a.$on("newStatusUpdatePosted",function(){a.newsFeed.getNewsFeedItems()})}])}(),function(){angular.module("NewsFeed").service("newsFeedDataService",["$http",function(a){this.getNewsFeedItems=function(b){var c={method:"GET",url:"api/newsfeed/items/"+b},d=function(a){return{success:!0,data:a.data}},e=function(a){return{success:!1,data:a.data}};return a(c).then(d,e)},this.postStatusUpdate=function(b){var c={method:"POST",url:"api/newsfeed/item",data:b},d=function(a){return{success:!0,data:a.data}},e=function(a){return{success:!1,data:a.data}};return a(c).then(d,e)}}])}(),function(){angular.module("NewsFeed").controller("NewsFeedItemController",["$scope","NEWS_FEED_TYPES",function(a,b){a.newsFeedItem={types:b}}])}(),function(){angular.module("NewsFeed").directive("newsFeedItem",[function(){return{restrict:"E",replace:"true",scope:{details:"=ngModel"},templateUrl:"app/newsFeed/directives/partials/newsFeedItem.tpl.html",controller:"NewsFeedItemController",link:function(a,b,c){a.$watch("details",function(b,c){a.newsFeedItem.details=b})}}}])}(),function(){angular.module("NewsFeed").constant("NEWS_FEED_TYPES",{TEXT:0,IMAGE:1,VIDEO:2})}(),function(){angular.module("SideMenu").controller("SideMenuController",["$scope",function(a){a.sideMenu={items:[{name:"News Feed",sref:"NewsFeed",selected:!1},{name:"Friends List",sref:"FriendsList",selected:!1}]},a.$on("$stateChangeSuccess",function(b,c){_.each(a.sideMenu.items,function(a){a.selected=a.sref===c.name})})}])}(),function(){angular.module("Widgets").controller("UserStatusWidgetController",["$scope","$window","newsFeedDataService","NEWS_FEED_TYPES",function(a,b,c,d){a.userStatusWidget={containsImageLink:!1,contentUrl:null,newsFeedTypes:d,statusText:"",statusType:d.TEXT},a.userStatusWidget.checkStatusType=function(){if(null!=a.userStatusWidget.statusText&&0!==a.userStatusWidget.statusText.length){var b=a.userStatusWidget.statusText.split(/\s/),c=_.find(b,function(a){return/(jpg|gif|png)/.test(a.trim())});if(null!=c){a.userStatusWidget.statusType=d.IMAGE;var e=c.split(/(jpg|gif|png)/);a.userStatusWidget.contentUrl=e[0]+e[1]}else a.userStatusWidget.statusType=d.TEXT,a.userStatusWidget.contentUrl=null}},a.userStatusWidget.clear=function(){a.userStatusWidget.statusText="",a.userStatusWidget.contentUrl=null,a.userStatusWidget.statusType=d.TEXT},a.userStatusWidget.submit=function(){var d=null!=a.userStatusWidget.contentUrl?a.userStatusWidget.statusText.replace(a.userStatusWidget.contentUrl,""):a.userStatusWidget.statusText,e={type:a.userStatusWidget.statusType,user:b.currentUser,text:d,contentUrl:a.userStatusWidget.contentUrl,createDT:new Date};c.postStatusUpdate(e).then(function(b){if(!b.success)throw"Error posting status";a.userStatusWidget.clear(),a.$broadcast("newStatusUpdatePosted")})}}])}(),function(){angular.module("NewsFeed").directive("userStatusWidget",[function(){return{restrict:"E",replace:"true",templateUrl:"app/widgets/directives/partials/userStatusWidget.tpl.html",controller:"UserStatusWidgetController"}}])}(),function(){angular.module("AppUsers").controller("FriendsListController",["$scope","$window","appUserDataService",function(a,b,c){function d(){a.friendsList.populateFriends()}a.friendsList={},a.friendsList.populateFriends=function(){if(!(null!=b.currentUser&null!=b.currentUser._id))throw"Current user is null";c.getFriendsList(b.currentUser._id).then(function(b){if(!b.success||null==b||null==b.data||null==b.data.data)throw"Error retrieving friends list";a.friendsList.items=b.data.data})},b.currentUser&&d(),a.$on("currentUserSet",function(a,c){if(null==c)throw"Current user null";b.currentUser=c,d()})}])}(),function(){angular.module("AppUsers").service("appUserDataService",["$http",function(a){this.getCurrentUser=function(){var b={method:"GET",url:"api/users/current"},c=function(a){return{success:!0,data:a.data}},d=function(a){return{success:!1,data:a.data}};return a(b).then(c,d)},this.getFriendsList=function(b){var c={method:"GET",url:"api/users/friends/"+b},d=function(a){return{success:!0,data:a.data}},e=function(a){return{success:!1,data:a.data}};return a(c).then(d,e)}}])}(),function(){angular.module("AppUsers").controller("UserInfoCardController",["$scope",function(a){a.userInfoCard={}}])}(),function(){angular.module("AppUsers").directive("userInfoCard",[function(){return{restrict:"E",replace:"true",scope:{details:"=ngModel"},templateUrl:"app/users/directives/partials/userInfoCard.tpl.html",controller:"UserInfoCardController",link:function(a,b,c){a.$watch("details",function(b,c){a.userInfoCard.details=b})}}}])}();